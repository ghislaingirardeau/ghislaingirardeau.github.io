import{Q as re,a as oe}from"./QLayout-NQ14Yntz.js";import{Q as ae,a as ie}from"./QHeader-BSc-UunN.js";import{Q as se}from"./QToolbar-DWjG14Ip.js";import{d as f,_ as p,B as c,C as u,Q as g,J as j,c as ce,l as y,h as le,A as ue,aX as O,o as x,D as _,E as A,N as V,G as K,r as E,aj as N,aY as D,X as G,S as q,F as de,aZ as me,T as fe,U as pe,a5 as U,a_ as J,a$ as _e,R as ge}from"./index-BA5aWebT.js";import{w as he,x as be,y as we,z as ye,A as ve,B as Ae,C as Re,D as Se,E as Ce,F as Ee,G as Oe,m as Pe,H as Te,I as Ie,J as We}from"./index-BqawO4WD.js";import{u as z,a as xe,b as C,c as M}from"./shoppingItems-B2rG07Td.js";import{u as Q}from"./lists-D77KvrHD.js";import{u as Ne}from"./card-D-jiq-ML.js";import{s as De,a as L,p as Le,b as $e,c as ke}from"./firebase-Cpzt2PAy.js";import{b as Y}from"./index-DdZkc7W-.js";import"./QScrollObserver-BEOk-l2M.js";import"./QResizeObserver-C0OKpkct.js";import"./index-BALEXJ3-.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-C32mnd9j.js";import"./vue.runtime.esm-bundler-BnDNC94M.js";const Be=f({__name:"EmptyCartWidget",setup(e,{expose:n}){n();const r=z(),{emptyCart:t}=r,o={shoppingList:r,emptyCart:t,get mdiCartRemove(){return he}};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}});function Ue(e,n,r,t,o,a){return c(),u(g,{size:"sm",round:"",icon:t.mdiCartRemove,class:"q-ml-sm text-white",onClick:t.emptyCart},null,8,["icon","onClick"])}const Ke=p(Be,[["render",Ue],["__file","EmptyCartWidget.vue"]]),qe=f({__name:"ShoppingCartWidget",setup(e,{expose:n}){n();const r=j();async function t(){r.push({name:"wallet",query:{showShoppingCard:"true"}}),await xe()}const o={router:r,handleGoToWallet:t,get mdiAccountCreditCard(){return be}};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}});function He(e,n,r,t,o,a){return c(),u(g,{size:"sm",round:"",icon:t.mdiAccountCreditCard,class:"q-ml-md text-white",onClick:t.handleGoToWallet},null,8,["icon"])}const Fe=p(qe,[["render",He],["__file","ShoppingCartWidget.vue"]]),je=["top","middle","bottom"],Ve=ce({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>je.includes(e)}},setup(e,{slots:n}){const r=y(()=>e.align!==void 0?{verticalAlign:e.align}:null),t=y(()=>{const o=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(o!==void 0?` text-${o}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>le("div",{class:t.value,style:r.value,role:"status","aria-label":e.label},ue(n.default,e.label!==void 0?[e.label]:[]))}}),Ge=f({__name:"CleanCartWidget",setup(e,{expose:n}){n();const r=z(),{totalItems:t}=O(r),{cleanCart:o}=r;x(()=>{navigator.setAppBadge&&navigator.setAppBadge(t.value)});const a={shoppingList:r,totalItems:t,cleanCart:o,get mdiBasketRemove(){return we}};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}});function Je(e,n,r,t,o,a){return c(),u(g,{size:"sm",round:"",icon:t.mdiBasketRemove,class:"clean-card-widget q-ml-md text-white",onClick:t.cleanCart},{default:_(()=>[A(Ve,{color:"red",floating:""},{default:_(()=>[V(K(t.totalItems),1)]),_:1})]),_:1},8,["icon","onClick"])}const ze=p(Ge,[["render",Je],["__file","CleanCartWidget.vue"]]),Me=f({__name:"DownloadWidget",setup(e,{expose:n}){n();const r=E(null),t=E(!1);async function o(){r.value&&(await r.value.prompt(),(await r.value.userChoice).outcome==="accepted"?console.log("User accepted PWA install"):console.log("User dismissed PWA install"),r.value=null)}x(()=>{window.matchMedia("(display-mode: standalone)").matches&&(t.value=!0),window.addEventListener("beforeinstallprompt",i=>{console.log("beforeinstallprompt event triggered."),i.preventDefault(),r.value=i,N.create({message:"Télécharger l'application sur votre mobile ?",color:"primary",icon:"download",timeout:5e3,actions:[{label:"Télécharger",color:"white",handler:()=>{o()}}]})}),window.addEventListener("appinstalled",()=>{console.log("PWA installed."),t.value=!0})});const a={deferredPrompt:r,isInstalled:t,handlePromptInstall:o,get mdiDownload(){return ye}};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}});function Qe(e,n,r,t,o,a){return c(),u(g,{key:0,size:"sm",round:"",icon:t.mdiDownload,class:"q-ml-sm text-white mr-2",onClick:t.handlePromptInstall},null,8,["icon"])}const P=p(Me,[["render",Qe],["__file","DownloadWidget.vue"]]),Ye=f({__name:"HomeWidget",setup(e,{expose:n}){n();const r=j(),t=D(),o=y(()=>t.name),a={router:r,route:t,routeName:o,get mdiArrowLeftBold(){return ve},get mdiListBoxOutline(){return Ae}};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}});function Xe(e,n,r,t,o,a){return t.routeName!=="home"?(c(),u(g,{key:0,size:"sm",round:"",icon:t.routeName==="list-id"?t.mdiListBoxOutline:t.mdiArrowLeftBold,class:"q-ml-sm text-white",onClick:n[0]||(n[0]=i=>t.router.go(-1))},null,8,["icon"])):G("",!0)}const Ze=p(Ye,[["render",Xe],["__file","HomeWidget.vue"]]),et=f({__name:"AddListWidget",setup(e,{expose:n}){n();const r=Q(),{showDialogNewList:t}=r,o={listsStore:r,showDialogNewList:t,get mdiCardPlus(){return Re}};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}});function tt(e,n,r,t,o,a){return c(),u(g,{size:"sm",round:"",icon:t.mdiCardPlus,class:"q-ml-sm text-white",onClick:t.showDialogNewList},null,8,["icon","onClick"])}const nt=p(et,[["render",tt],["__file","AddListWidget.vue"]]),rt=f({__name:"AddItemWidget",setup(e,{expose:n}){n();const r=Q(),{showDialogNewList:t}=r,o={listsStore:r,showDialogNewList:t,get mdiPlusBox(){return Se}};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}});function ot(e,n,r,t,o,a){return c(),u(g,{size:"sm",round:"",icon:t.mdiPlusBox,class:"q-ml-sm text-white",onClick:t.showDialogNewList},null,8,["icon","onClick"])}const at=p(rt,[["render",ot],["__file","AddItemWidget.vue"]]),it=f({__name:"AddCardWidget",setup(e,{expose:n}){n();const r=Ne(),{showDialogCard:t}=r,o={cardsStore:r,showDialogCard:t,get mdiCreditCardPlusOutline(){return Ce}};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}});function st(e,n,r,t,o,a){return c(),u(g,{size:"sm",round:"",icon:t.mdiCreditCardPlusOutline,class:"q-ml-sm text-white",onClick:t.showDialogCard},null,8,["icon","onClick"])}const ct=p(it,[["render",st],["__file","AddCardWidget.vue"]]);function R(e){const n=new Uint8Array(e);let r="";for(const o of n)r+=String.fromCharCode(o);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function W(e){const n=e.replace(/-/g,"+").replace(/_/g,"/"),r=(4-n.length%4)%4,t=n.padEnd(n.length+r,"="),o=atob(t),a=new ArrayBuffer(o.length),i=new Uint8Array(a);for(let s=0;s<o.length;s++)i[s]=o.charCodeAt(s);return a}function H(){return lt.stubThis(globalThis?.PublicKeyCredential!==void 0&&typeof globalThis.PublicKeyCredential=="function")}const lt={stubThis:e=>e};function X(e){const{id:n}=e;return{...e,id:W(n),transports:e.transports}}function Z(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}class d extends Error{constructor({message:n,code:r,cause:t,name:o}){super(n,{cause:t}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=o??t.name,this.code=r}}function ut({error:e,options:n}){const{publicKey:r}=n;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(n.signal instanceof AbortSignal)return new d({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(r.authenticatorSelection?.requireResidentKey===!0)return new d({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(n.mediation==="conditional"&&r.authenticatorSelection?.userVerification==="required")return new d({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(r.authenticatorSelection?.userVerification==="required")return new d({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new d({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new d({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return r.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new d({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new d({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const t=globalThis.location.hostname;if(Z(t)){if(r.rp.id!==t)return new d({message:`The RP ID "${r.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new d({message:`${globalThis.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(r.user.id.byteLength<1||r.user.id.byteLength>64)return new d({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new d({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}class dt{constructor(){Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const n=new AbortController;return this.controller=n,n.signal}cancelCeremony(){if(this.controller){const n=new Error("Manually cancelling existing WebAuthn API call");n.name="AbortError",this.controller.abort(n),this.controller=void 0}}}const ee=new dt,mt=["cross-platform","platform"];function te(e){if(e&&!(mt.indexOf(e)<0))return e}async function ft(e){!e.optionsJSON&&e.challenge&&(console.warn("startRegistration() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information."),e={optionsJSON:e});const{optionsJSON:n,useAutoRegister:r=!1}=e;if(!H())throw new Error("WebAuthn is not supported in this browser");const t={...n,challenge:W(n.challenge),user:{...n.user,id:W(n.user.id)},excludeCredentials:n.excludeCredentials?.map(X)},o={};r&&(o.mediation="conditional"),o.publicKey=t,o.signal=ee.createNewAbortSignal();let a;try{a=await navigator.credentials.create(o)}catch(w){throw ut({error:w,options:o})}if(!a)throw new Error("Registration was not completed");const{id:i,rawId:s,response:l,type:h}=a;let m;typeof l.getTransports=="function"&&(m=l.getTransports());let b;if(typeof l.getPublicKeyAlgorithm=="function")try{b=l.getPublicKeyAlgorithm()}catch(w){$("getPublicKeyAlgorithm()",w)}let v;if(typeof l.getPublicKey=="function")try{const w=l.getPublicKey();w!==null&&(v=R(w))}catch(w){$("getPublicKey()",w)}let S;if(typeof l.getAuthenticatorData=="function")try{S=R(l.getAuthenticatorData())}catch(w){$("getAuthenticatorData()",w)}return{id:i,rawId:R(s),response:{attestationObject:R(l.attestationObject),clientDataJSON:R(l.clientDataJSON),transports:m,publicKeyAlgorithm:b,publicKey:v,authenticatorData:S},type:h,clientExtensionResults:a.getClientExtensionResults(),authenticatorAttachment:te(a.authenticatorAttachment)}}function $(e,n){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${e}. You should report this error to them.
`,n)}function pt(){if(!H())return k.stubThis(new Promise(n=>n(!1)));const e=globalThis.PublicKeyCredential;return e?.isConditionalMediationAvailable===void 0?k.stubThis(new Promise(n=>n(!1))):k.stubThis(e.isConditionalMediationAvailable())}const k={stubThis:e=>e};function _t({error:e,options:n}){const{publicKey:r}=n;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(n.signal instanceof AbortSignal)return new d({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new d({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const t=globalThis.location.hostname;if(Z(t)){if(r.rpId!==t)return new d({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new d({message:`${globalThis.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new d({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}async function gt(e){!e.optionsJSON&&e.challenge&&(console.warn("startAuthentication() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information."),e={optionsJSON:e});const{optionsJSON:n,useBrowserAutofill:r=!1,verifyBrowserAutofillInput:t=!0}=e;if(!H())throw new Error("WebAuthn is not supported in this browser");let o;n.allowCredentials?.length!==0&&(o=n.allowCredentials?.map(X));const a={...n,challenge:W(n.challenge),allowCredentials:o},i={};if(r){if(!await pt())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1&&t)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');i.mediation="conditional",a.allowCredentials=[]}i.publicKey=a,i.signal=ee.createNewAbortSignal();let s;try{s=await navigator.credentials.get(i)}catch(S){throw _t({error:S,options:i})}if(!s)throw new Error("Authentication was not completed");const{id:l,rawId:h,response:m,type:b}=s;let v;return m.userHandle&&(v=R(m.userHandle)),{id:l,rawId:R(h),response:{authenticatorData:R(m.authenticatorData),clientDataJSON:R(m.clientDataJSON),signature:R(m.signature),userHandle:v},type:b,clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:te(s.authenticatorAttachment)}}const T=C(),I={async registerCredential(){try{const n=await(await fetch("https://webauth-firebase.onrender.com/auth/generate-registration-options",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:T.user}),credentials:"include"})).json();n.authenticatorSelection={residentKey:"required",userVerification:"preferred"},n.extensions={credProps:!0};const r=await ft({optionsJSON:n});return await fetch("https://webauth-firebase.onrender.com/auth/verify-registration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({attResp:r}),credentials:"include"}),{message:"Enregistrement réussi",success:!0}}catch(e){return console.log(e.message),{message:"Échec de l'enregistrement",success:!1}}},async loginWithCredential(){try{T.isFetchingData=!0;const n=await(await fetch("https://webauth-firebase.onrender.com/auth/generate-authentication-options",{credentials:"include"})).json();n.userVerification="required";const r=await gt({optionsJSON:n}),t=await fetch("https://webauth-firebase.onrender.com/auth/verify-authentication",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"include"}),{token:o}=await t.json();return await ne.signInWithWebAuth(o),T.isFetchingData=!1,{success:!0}}catch(e){return console.log(e.message,"try to regsiter credential first"),N.create({message:"L'authentification a échoué, veuillez réessayer",color:"negative",icon:Ee,timeout:3e3,progress:!0}),T.isFetchingData=!1,{success:!1}}},async logout(){try{return await fetch("https://webauth-firebase.onrender.com/logout",{credentials:"include"}),{success:!0}}catch{return{success:!1}}},async isAuthentificate(){try{const e=await fetch("https://webauth-firebase.onrender.com/me",{credentials:"include"}),{user:n}=await e.json();return{user:n}}catch(e){return console.log(e.message),{user:void 0}}}},ht=C(),ne={async signInWithGoogle(){try{await De(L,Le)}catch(e){console.error("Erreur d'authentification :",e)}},async signInWithWebAuth(e){try{await $e(L,e)}catch(n){console.error("Erreur d'authentification :",n)}},async logout(){await ke(L),console.log("Utilisateur déconnecté"),ht.hasWebAuthRegister&&await I.logout()}},bt=f({__name:"AuthentificationWidget",setup(e,{expose:n}){n();const r=C(),{loggedIn:t}=O(r),o={auth:r,loggedIn:t,get mdiAccountPlus(){return Oe},get mdiLogout(){return Pe},get useFirebaseAuth(){return ne}};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}});function wt(e,n,r,t,o,a){return c(),q("div",null,[t.loggedIn?(c(),u(g,{key:0,size:"sm",round:"",icon:t.mdiLogout,class:"q-ml-sm text-white",onClick:t.useFirebaseAuth.logout},null,8,["icon","onClick"])):(c(),u(g,{key:1,size:"sm",round:"",icon:t.mdiAccountPlus,class:"q-ml-sm text-white",onClick:t.useFirebaseAuth.signInWithGoogle},null,8,["icon","onClick"]))])}const B=p(bt,[["render",wt],["__file","AuthentificationWidget.vue"]]),yt=f({__name:"webAuthWidget",setup(e,{expose:n}){n();const r=C(),{hasWebAuthRegister:t,isFetchingData:o}=O(r),a=E(!1),i=E(!1);x(async()=>{(await I.isAuthentificate()).user&&(i.value=!0)});async function s(){t.value?await h():await l()}async function l(){a.value=!0,(await I.registerCredential()).success&&(t.value=!0),a.value=!1}async function h(){a.value=!0,(await I.loginWithCredential()).success&&(i.value=!0),a.value=!1}const m={auth:r,hasWebAuthRegister:t,isFetchingData:o,isLoading:a,isLoggedIn:i,initWebAuth:s,register:l,login:h,get mdiFingerprint(){return Te}};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}});function vt(e,n,r,t,o,a){return c(),u(g,{size:"sm",round:"",icon:t.mdiFingerprint,loading:t.isFetchingData,class:"q-ml-sm text-white",onClick:t.initWebAuth},null,8,["icon","loading"])}const At=p(yt,[["render",vt],["__file","webAuthWidget.vue"]]),Rt=f({__name:"UserNameWidget",setup(e,{expose:n}){n();const r=C(),{user:t}=O(r),o=y(()=>t.value?t.value.displayName:""),a={auth:r,user:t,userName:o};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}});function St(e,n,r,t,o,a){return c(),q("div",null,[de("span",null,K(t.userName),1)])}const F=p(Rt,[["render",St],["__file","UserNameWidget.vue"]]),Ct=f({__name:"LayoutHeader",setup(e,{expose:n}){n();const r=D(),t=Y(),o=C(),{user:a,hasWebAuthRegister:i,loggedIn:s}=O(o),l=y(()=>r.meta.title||window.history.state?.name),h=y(()=>a.value!==null&&i.value===!1),m=y(()=>a.value===null&&i.value===!0),b=y(()=>{switch(r.name){case"lists":return[nt];case"list-id":return[at];case"wallet":return[ct];case"wallet-id":return[];case"shopping":return[Ke,ze,Fe];default:return t.value?m.value||h.value?[P,F,B,At]:s.value?[P,F,B]:[P,B]:[P]}}),v={route:r,online:t,auth:o,user:a,hasWebAuthRegister:i,loggedIn:s,title:l,isConnectedAndNotRegister:h,isLogoutAndRegister:m,componentsToLoad:b,HomeWidget:Ze};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}});function Et(e,n,r,t,o,a){return c(),u(ie,{elevated:"",class:"bg-primary text-white"},{default:_(()=>[A(U,{name:"fade",mode:"out-in"},{default:_(()=>[(c(),u(se,{key:t.route.path},{default:_(()=>[A(t.HomeWidget),A(ae,{class:"ml-2"},{default:_(()=>[V(K(t.title),1)]),_:1}),A(me,{appear:"",name:"fade-X",mode:"out-in",tag:"div",class:"flex flex-center"},{default:_(()=>[(c(!0),q(pe,null,fe(t.componentsToLoad,(i,s)=>(c(),u(J(i),{key:s,class:"animated-component transition-all"}))),128))]),_:1})]),_:1}))]),_:1})]),_:1})}const Ot=p(Ct,[["render",Et],["__scopeId","data-v-43921838"],["__file","LayoutHeader.vue"]]),Pt=f({__name:"SaveWidget",setup(e,{expose:n}){const r=C(),{user:t,isFetchingData:o}=O(r),a=E(!1),i=E(!1),s=D(),l=Y(),h=y(()=>s.name==="shopping"),m=y(()=>i.value?Ie:We),b=y(()=>i.value?"warning":"secondary");async function v(){a.value=!0,l.value?await M():(i.value=!0,await(await navigator.serviceWorker.ready).sync.register("sync-firestore"),N.create({message:"Hors ligne : données enregistrées localement",color:"warning",icon:"cloud_off"})),a.value=!1}n({isSaving:a,isSyncPending:i});const S={auth:r,user:t,isFetchingData:o,isSaving:a,isSyncPending:i,route:s,online:l,isShoppingPage:h,iconType:m,iconColor:b,saveToFirestore:v};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}});function Tt(e,n,r,t,o,a){return t.user&&!t.isShoppingPage?(c(),u(g,{key:0,class:"fixed fixed-bottom-right mr-5 mb-5",color:t.iconColor,icon:t.iconType,round:"",float:"",loading:t.isSaving||t.isFetchingData,onClick:t.saveToFirestore},null,8,["color","icon","loading"])):G("",!0)}const It=p(Pt,[["render",Tt],["__file","SaveWidget.vue"]]),Wt=f({__name:"HomeLayout",setup(e,{expose:n}){n();const r=_e("save-widget-ref"),t=D();x(()=>{o()});function o(){navigator.serviceWorker.addEventListener("message",async i=>{if(i.data?.type==="PROCESS_FIRESTORE_QUEUE")try{r.value.isSaving=!0,await M(!1),N.create({message:"De nouveau en ligne : données synchronisées",color:"secondary",icon:"cloud_sync",timeout:3e3}),r.value.isSaving=!1,r.value.isSyncPending=!1}catch(s){console.error("Erreur Firestore:",s);return}})}const a={saveWidgetRef:r,route:t,serviceWorkerSyncListener:o,LayoutHeader:Ot,SaveWidget:It};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}});function xt(e,n,r,t,o,a){const i=ge("router-view");return c(),u(re,{view:"hHh lpR fFf"},{default:_(()=>[A(t.LayoutHeader),A(oe,null,{default:_(()=>[A(i,null,{default:_(({Component:s})=>[A(U,{name:t.route.meta.transition||"fade",mode:"out-in"},{default:_(()=>[(c(),u(J(s)))]),_:2},1032,["name"])]),_:1}),A(U,{name:"fade",mode:"out-in"},{default:_(()=>[(c(),u(t.SaveWidget,{ref:"save-widget-ref",key:t.route.path}))]),_:1})]),_:1})]),_:1})}const Mt=p(Wt,[["render",xt],["__file","HomeLayout.vue"]]);export{Mt as default};
